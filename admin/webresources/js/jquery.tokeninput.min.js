!function(t){function e(t){return String(null===t||void 0===t?"":t)}function n(t){return e(t).replace(l,function(t){return d[t]})}var s={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch];return"<li>"+(this.enableHTML?e:n(e))+"</li>"},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:n(e))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!0,tokenValue:"id",allowFreeTagging:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},a={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},i={BEFORE:0,AFTER:1,END:2},o={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},d={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},l=/[&<>"'\/]/g,r={init:function(e,n){var a=t.extend({},s,n||{});return this.each(function(){t(this).data("settings",a),t(this).data("tokenInputObject",new t.TokenList(this,e,a))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(t){return this.data("tokenInputObject").add(t),this},remove:function(t){return this.data("tokenInputObject").remove(t),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(t){return this.data("tokenInputObject").toggleDisabled(t),this},setOptions:function(e){return t(this).data("settings",t.extend({},t(this).data("settings"),e||{})),this}};t.fn.tokenInput=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):r.init.apply(this,arguments)},t.TokenList=function(e,s){function d(s){return t(e).data("settings").enableHTML?s:n(s)}function l(n){t(e).data("settings").disabled="boolean"==typeof n?n:!t(e).data("settings").disabled,H.attr("disabled",t(e).data("settings").disabled),W.toggleClass(t(e).data("settings").classes.disabled,t(e).data("settings").disabled),z&&f(t(z),i.END),_.attr("disabled",t(e).data("settings").disabled)}function r(){return null!==t(e).data("settings").tokenLimit&&M>=t(e).data("settings").tokenLimit?(H.hide(),void T()):void 0}function u(){N!==(N=H.val())&&(K.html(n(N)),H.width(K.width()+30))}function c(){var n=t.trim(H.val()),s=n.split(t(e).data("settings").tokenDelimiter);t.each(s,function(n,s){if(s){t.isFunction(t(e).data("settings").onFreeTaggingAdd)&&(s=t(e).data("settings").onFreeTaggingAdd.call(_,s));var a={};a[t(e).data("settings").tokenValue]=a[t(e).data("settings").propertyToSearch]=s,p(a)}})}function g(n){var s=t(t(e).data("settings").tokenFormatter(n)),a=n.readonly===!0?!0:!1;a&&s.addClass(t(e).data("settings").classes.tokenReadOnly),s.addClass(t(e).data("settings").classes.token).insertBefore(V),a||t("<span>"+t(e).data("settings").deleteText+"</span>").addClass(t(e).data("settings").classes.tokenDelete).appendTo(s).click(function(){return t(e).data("settings").disabled?void 0:(m(t(this).parent()),_.change(),!1)});var i=n;return t.data(s.get(0),"tokeninput",n),j=j.slice(0,G).concat([i]).concat(j.slice(G)),G++,v(j,_),M+=1,null!==t(e).data("settings").tokenLimit&&M>=t(e).data("settings").tokenLimit&&(H.hide(),T()),s}function p(n){var s=t(e).data("settings").onAdd;if(M>0&&t(e).data("settings").preventDuplicates){var a=null;if(W.children().each(function(){var e=t(this),s=t.data(e.get(0),"tokeninput");return s&&s.id===n.id?(a=e,!1):void 0}),a)return h(a),V.insertAfter(a),void O(H)}(null==t(e).data("settings").tokenLimit||M<t(e).data("settings").tokenLimit)&&(g(n),r()),H.val(""),T(),t.isFunction(s)&&s.call(_,n)}function h(n){t(e).data("settings").disabled||(n.addClass(t(e).data("settings").classes.selectedToken),z=n.get(0),H.val(""),T())}function f(n,s){n.removeClass(t(e).data("settings").classes.selectedToken),z=null,s===i.BEFORE?(V.insertBefore(n),G--):s===i.AFTER?(V.insertAfter(n),G++):(V.appendTo(W),G=M),O(H)}function k(e){var n=z;z&&f(t(z),i.END),n===e.get(0)?f(e,i.END):h(e)}function m(n){var s=t.data(n.get(0),"tokeninput"),a=t(e).data("settings").onDelete,i=n.prevAll().length;i>G&&i--,n.remove(),z=null,O(H),j=j.slice(0,i).concat(j.slice(i+1)),G>i&&G--,v(j,_),M-=1,null!==t(e).data("settings").tokenLimit&&(H.show().val(""),O(H)),t.isFunction(a)&&a.call(_,s)}function v(n,s){var a=t.map(n,function(n){return"function"==typeof t(e).data("settings").tokenValue?t(e).data("settings").tokenValue.call(this,n):n[t(e).data("settings").tokenValue]});s.val(a.join(t(e).data("settings").tokenDelimiter))}function T(){q.hide().empty(),U=null}function y(){q.css({position:"absolute",top:t(W).offset().top+t(W).outerHeight(),left:t(W).offset().left,width:t(W).width(),"z-index":t(e).data("settings").zindex}).show()}function C(){t(e).data("settings").searchingText&&(q.html("<p>"+d(t(e).data("settings").searchingText)+"</p>"),y())}function b(){t(e).data("settings").hintText&&(q.html("<p>"+d(t(e).data("settings").hintText)+"</p>"),y())}function E(t){return t.replace(Q,"\\$&")}function w(t,e){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){return"<b>"+d(e)+"</b>"})}function D(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+E(e)+")(?![^<>]*>)(?![^&;]+;)","g"),w(e,n))}function R(n,s){if(s&&s.length){q.empty();var a=t("<ul>").appendTo(q).mouseover(function(e){x(t(e.target).closest("li"))}).mousedown(function(e){return p(t(e.target).closest("li").data("tokeninput")),_.change(),!1}).hide();t(e).data("settings").resultsLimit&&s.length>t(e).data("settings").resultsLimit&&(s=s.slice(0,t(e).data("settings").resultsLimit)),t.each(s,function(s,i){var o=t(e).data("settings").resultsFormatter(i);o=D(o,i[t(e).data("settings").propertyToSearch],n),o=t(o).appendTo(a),o.addClass(s%2?t(e).data("settings").classes.dropdownItem:t(e).data("settings").classes.dropdownItem2),0===s&&x(o),t.data(o.get(0),"tokeninput",i)}),y(),t(e).data("settings").animateDropdown?a.slideDown("fast"):a.show()}else t(e).data("settings").noResultsText&&(q.html("<p>"+d(t(e).data("settings").noResultsText)+"</p>"),y())}function x(n){n&&(U&&F(t(U)),n.addClass(t(e).data("settings").classes.selectedDropdownItem),U=n.get(0))}function F(n){n.removeClass(t(e).data("settings").classes.selectedDropdownItem),U=null}function L(){var n=H.val();t("#typed_title").val(n),n&&n.length&&(z&&f(t(z),i.AFTER),n.length>=t(e).data("settings").minChars?(C(),clearTimeout(I),I=setTimeout(function(){A(n)},t(e).data("settings").searchDelay)):T())}function A(n){var s=n+P(),a=B.get(s);if(a)t.isFunction(t(e).data("settings").onCachedResult)&&(a=t(e).data("settings").onCachedResult.call(_,a)),R(n,a);else if(t(e).data("settings").url){var i=P(),o={};if(o.data={},i.indexOf("?")>-1){var d=i.split("?");o.url=d[0];var l=d[1].split("&");t.each(l,function(t,e){var n=e.split("=");o.data[n[0]]=n[1]})}else o.url=i;o.data[t(e).data("settings").queryParam]=n,o.type=t(e).data("settings").method,o.dataType=t(e).data("settings").contentType,t(e).data("settings").crossDomain&&(o.dataType="jsonp"),o.success=function(a){B.add(s,t(e).data("settings").jsonContainer?a[t(e).data("settings").jsonContainer]:a),t.isFunction(t(e).data("settings").onResult)&&(a=t(e).data("settings").onResult.call(_,a)),H.val()===n&&R(n,t(e).data("settings").jsonContainer?a[t(e).data("settings").jsonContainer]:a)},t.ajax(o)}else if(t(e).data("settings").local_data){var r=t.grep(t(e).data("settings").local_data,function(s){return s[t(e).data("settings").propertyToSearch].toLowerCase().indexOf(n.toLowerCase())>-1});B.add(s,r),t.isFunction(t(e).data("settings").onResult)&&(r=t(e).data("settings").onResult.call(_,r)),R(n,r)}}function P(){var n=t(e).data("settings").url;return"function"==typeof t(e).data("settings").url&&(n=t(e).data("settings").url.call(t(e).data("settings"))),n}function O(t){setTimeout(function(){t.focus()},50)}if("string"===t.type(s)||"function"===t.type(s)){t(e).data("settings").url=s;var S=P();void 0===t(e).data("settings").crossDomain&&"string"==typeof S&&(t(e).data("settings").crossDomain=-1===S.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==S.split(/\/+/g)[1])}else"object"==typeof s&&(t(e).data("settings").local_data=s);t(e).data("settings").classes?t(e).data("settings").classes=t.extend({},a,t(e).data("settings").classes):t(e).data("settings").theme?(t(e).data("settings").classes={},t.each(a,function(n,s){t(e).data("settings").classes[n]=s+"-"+t(e).data("settings").theme})):t(e).data("settings").classes=a;var I,N,j=[],M=0,B=new t.TokenList.Cache,H=t('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",t(e).data("settings").idPrefix+e.id).focus(function(){return t(e).data("settings").disabled?!1:((null===t(e).data("settings").tokenLimit||t(e).data("settings").tokenLimit!==M)&&b(),void W.addClass(t(e).data("settings").classes.focused))}).blur(function(){T(),t(this).val(""),W.removeClass(t(e).data("settings").classes.focused),t(e).data("settings").allowFreeTagging?c():t(this).val(""),W.removeClass(t(e).data("settings").classes.focused)}).bind("keyup keydown blur update",u).keydown(function(n){var s,a;switch(n.keyCode){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:if(t(this).val()){var d=null;d=n.keyCode===o.DOWN||n.keyCode===o.RIGHT?t(U).next():t(U).prev(),d.length&&x(d)}else s=V.prev(),a=V.next(),s.length&&s.get(0)===z||a.length&&a.get(0)===z?n.keyCode===o.LEFT||n.keyCode===o.UP?f(t(z),i.BEFORE):f(t(z),i.AFTER):n.keyCode!==o.LEFT&&n.keyCode!==o.UP||!s.length?n.keyCode!==o.RIGHT&&n.keyCode!==o.DOWN||!a.length||h(t(a.get(0))):h(t(s.get(0)));return!1;case o.BACKSPACE:if(s=V.prev(),!t(this).val().length)return z?(m(t(z)),_.change()):s.length&&h(t(s.get(0))),!1;1===t(this).val().length?T():setTimeout(function(){L()},5);break;case o.TAB:case o.ENTER:case o.NUMPAD_ENTER:case o.COMMA:return U?(p(t(U).data("tokeninput")),_.change()):(t(e).data("settings").allowFreeTagging?c():t(this).val(""),n.stopPropagation(),n.preventDefault()),!1;case o.ESCAPE:return T(),!0;default:String.fromCharCode(n.which)&&setTimeout(function(){L()},5)}}),_=t(e).hide().val("").focus(function(){O(H)}).blur(function(){H.blur()}),z=null,G=0,U=null,W=t("<ul />").addClass(t(e).data("settings").classes.tokenList).click(function(e){var n=t(e.target).closest("li");n&&n.get(0)&&t.data(n.get(0),"tokeninput")?k(n):(z&&f(t(z),i.END),O(H))}).mouseover(function(n){var s=t(n.target).closest("li");s&&z!==this&&s.addClass(t(e).data("settings").classes.highlightedToken)}).mouseout(function(n){var s=t(n.target).closest("li");s&&z!==this&&s.removeClass(t(e).data("settings").classes.highlightedToken)}).insertBefore(_),V=t("<li />").addClass(t(e).data("settings").classes.inputToken).appendTo(W).append(H),q=t("<div>").addClass(t(e).data("settings").classes.dropdown).appendTo("body").hide(),K=t("<tester/>").insertAfter(H).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:H.css("fontSize"),fontFamily:H.css("fontFamily"),fontWeight:H.css("fontWeight"),letterSpacing:H.css("letterSpacing"),whiteSpace:"nowrap"});_.val("");var $=t(e).data("settings").prePopulate||_.data("pre");t(e).data("settings").processPrePopulate&&t.isFunction(t(e).data("settings").onResult)&&($=t(e).data("settings").onResult.call(_,$)),$&&$.length&&t.each($,function(t,e){g(e),r()}),t(e).data("settings").disabled&&l(!0),t.isFunction(t(e).data("settings").onReady)&&t(e).data("settings").onReady.call(),this.clear=function(){W.children("li").each(function(){0===t(this).children("input").length&&m(t(this))})},this.add=function(t){p(t)},this.remove=function(e){W.children("li").each(function(){if(0===t(this).children("input").length){var n=t(this).data("tokeninput"),s=!0;for(var a in e)if(e[a]!==n[a]){s=!1;break}s&&m(t(this))}})},this.getTokens=function(){return j},this.toggleDisabled=function(t){l(t)};var Q=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},t.TokenList.Cache=function(e){var n=t.extend({max_size:500},e),s={},a=0,i=function(){s={},a=0};this.add=function(t,e){a>n.max_size&&i(),s[t]||(a+=1),s[t]=e},this.get=function(t){return s[t]}}}(jQuery);